var source,prefix,result,output,clipboard,download,error,$=jQuery,converter=new htmltodom,validatePrefix=function(){var e=converter.validateVarName(prefix.val()),i=prefix.closest(".form-group"),r=(i.find(".valid-feedback"),i.find(".invalid-feedback")),l=!prefix.val()||0==prefix.val().length;if(l||e){if(!l)return i.removeClass("is-invalid").addClass("is-valid"),prefix.removeClass("is-invalid").addClass("is-valid"),!0;i.removeClass("is-valid").addClass("is-invalid"),prefix.removeClass("is-valid").addClass("is-invalid"),r.html("This field is required.")}else i.removeClass("is-valid").addClass("is-invalid"),prefix.removeClass("is-valid").addClass("is-invalid"),r.html("Invalid variable name.");return!1},validateSource=function(){var e=!source.val()||0==source.val().length,i=source.closest("group");return e?(i.addClass("is-invalid").removeClass("is-valid"),source.addClass("is-invalid").removeClass("is-valid"),!1):(i.addClass("is-valid").removeClass("is-invalid"),source.addClass("is-valid").removeClass("is-invalid"),!0)},downloadFile=function(){"use strict";if(!validateSource()||!validatePrefix())return!1;if(void 0===output||null==output||0==output.length)return!1;var e=Date.now(),i=new File([output],"htmltodom-"+e+".js",{type:"text/javascript",lastModified:e}),r=document.createElement("a");r.href=URL.createObjectURL(i),r.setAttribute("download",i.name),document.body.appendChild(r),r.click(),r.remove()},showFullScreen=function(){"use strict";if(!validateSource()||!validatePrefix())return!1;if(void 0===output||null==output||0==output.length)return!1;var e=$("#source-popup"),i=e.find("pre").find("code");i.html(output),hljs.highlightBlock(i[0]),e.removeClass("hidden"),$("body").addClass("fullscreen"),$("#popup-close").click(function(){e.addClass("_hiding"),e.on("transitionEnd webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd",function(){e.hasClass("_hiding")&&(e.addClass("hidden").removeClass("_hiding"),$("body").removeClass("fullscreen"))})})};$(function(){source=$("#source"),prefix=$("#prefix"),(result={pre:$("#result")}).code=result.pre.find("code"),download=$("#download"),error=$("#error"),result.code.html("// Javascript code will appear here..."),hljs.highlightBlock(result.code[0]),source.on("change focusout blur",validateSource),prefix.on("change focusout blur keyup",validatePrefix),download.click(downloadFile),$("#reset").click(function(){result.code.html("// Javascript code will appear here...")}),$("#fullscreen").click(showFullScreen),$("#submit").on("click",function(){if(!validateSource()||!validatePrefix())return!1;var e=new Object({src:source.val(),options:{prefix:prefix.val(),plaintext:$("#plain-text")[0].checked,whitespace:$("#whitespace")[0].checked,comments:$("#comments")[0].checked}});try{output=converter.convert(e),result.code.html(output),hljs.highlightBlock(result.code[0]),result.pre.removeClass("empty"),error.addClass("hidden"),(clipboard=new ClipboardJS("#copy",{text:function(e){return output}})).on("success",function(e){var i=e.trigger.getAttribute("aria-label");e.trigger.setAttribute("aria-label","Copied!"),e.trigger.addEventListener("mouseleave",function(e,i){i.target.setAttribute("aria-label",e)}.bind(null,i),{once:!0})})}catch(e){console.error(e),result.pre.addClass("empty"),result.code.html("// Error, see above."),error.removeClass("hidden").html(e),hljs.highlightBlock(result.code[0]),output="",null!=clipboard&&clipboard.destroy()}})});